{#
 # This file is part of the OpenMiamMiam project.
 # (c) Isics <contact@isics.fr>
 #
 # This source file is subject to the AGPL v3 license that is bundled
 # with this source code in the file LICENSE.
 #}
{% embed 'IsicsOpenMiamMiamBundle:Branch:base.html.twig' with {'branch': branch} %}
    {% block title %}{{ 'cart.title'|trans }} - {{ parent() }}{% endblock %}

    {% block content %}
        <ol class="breadcrumb">
            <li><a href="{{ path('open_miam_miam_branch_homepage', {'branch_slug': branch.slug}) }}">{{ 'homepage'|trans }}</a></li>
            <li class="active">{{ 'cart.title'|trans }}</li>
        </ol>

        <h1>{{ 'cart.title'|trans }}</h1>

        {% set showNoPriceStatement = false %}
        {{ form_start(form) }}
            {{ form_errors(form) }}
            <table class="table table-bordered table-striped table-cart-products">
                <thead>
                    <tr>
                        <th>{{ 'product'|trans }}</th>
                        <th>{{ 'price'|trans }}</th>
                        <th>{{ 'quantity'|trans }}</th>
                        <th>{{ 'total'|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in form.items %}
                        <tr>
                            <td>
                                <a href="{{ path('open_miam_miam_branch_product', {'branch_slug': branch.slug, 'category_slug': item.vars.data.product.category.slug, 'product_slug': item.vars.data.product.slug}) }}">
                                    {{ item.vars.data.product.name }}
                                </a>
                            </td>
                            <td{% if item.vars.data.product.hasNoPrice %} class="td-no-price"{% endif %}>
                                {% if not item.vars.data.product.hasNoPrice %}
                                    {{ item.vars.data.product.price|number_format_currency(open_miam_miam.currency) }}
                                {% else %}
                                    {% set showNoPriceStatement = true %}
                                    <span class="glyphicon glyphicon-time"></span>*
                                {% endif %}
                            </td></td>
                            <td>
                                {{ form_widget(item.product) }}
                                {{ form_errors(item.quantity) }}
                                {{ form_widget(item.quantity, {'attr': {'class': 'form-control input-quantity'}}) }}
                            </td>
                            <td{% if item.vars.data.product.hasNoPrice %} class="td-no-price"{% endif %}>
                                {% if not item.vars.data.product.hasNoPrice %}
                                    {{ item.vars.data.total|number_format_currency(open_miam_miam.currency) }}
                                {% else %}
                                    <span class="glyphicon glyphicon-time"></span>*
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="3">{{ 'total'|trans }}</th>
                        <td>{{ form.vars.data.total|number_format_currency(open_miam_miam.currency) }}</td>
                    </tr>
                </tfoot>
            </table>

            {% if showNoPriceStatement %}
                {% include 'IsicsOpenMiamMiamBundle:Branch:noPriceStatement.html.twig' %}
            {% endif %}

            <button type="submit" class="btn btn-primary btn-lg pull-right" name="open_miam_miam_cart[checkout]" value="checkout" />
                <span class="glyphicon glyphicon-shopping-cart"></span>
                {{ 'checkout'|trans }}
            </button>
            {% do form.checkout.setRendered %}

            <button type="submit" class="btn btn-default btn-lg" name="open_miam_miam_cart[update]" value="update" />
                <span class="glyphicon glyphicon-refresh"></span>
                {{ 'update'|trans }}
            </button>
            {% do form.update.setRendered %}

        {{ form_end(form) }}
    {% endblock %}
{% endembed %}
